---
published: true
title: DeepSurv
use_math: true
category: Literature Review - DLEHR
layout: default
---

# Table of Contents

* TOC
{:toc}

# personalized treatment recommender system using a cox proportional hazards deep neural network

# Authors

Jared L. Katzman (Yale); Uri Shaham (Yale); Alexander Cloninger (Yale); Jonathan Bates (Yale); Tingting Jiang (Yale); Yuval Kluger (Yale)


# 1 Introduction

Standard survival models like the linear Cox proportional hazards model require extensive feature engineering and prior knowledge to model treatment interaction at individual level.

DeepSurv: a Cox proportional hazards deep neural network
-model interactions between a patient's covariates and treatment effectiveness; personalized treatment recommendations.


A standard survival model is the Cox proportional hazards model (CPH).
CPH is a semiparametric model that calculates the effects of observed covariates on the risk of an event occurring.
Assumes patient's risk of failure is a linear combination of the patient's covariates. "linear proportional hazards condition"
Often too simplistic to assume risk function is linear

To model nonlinear survival data, 3 main types of NN for survival analysis
1. classification methods
2. time-encoded methods
3. risk-predicting methods

Goal: 
1. show application of DL to SA performs as well as or better than other survival methods in predicting risk
2. demonstrate that DNN can be used as a personalized treatment recommender system

Propose:
a modern Cox proportional hazards deep neural network (DeepSurv)
1. show DeepSurv performs as well as or better than other SA methods on survival data with both linear and nonlinear risk functions
2. include additional categorical variable representing a patient's treatment group to illustrate how it can learn complex relationships between covariates and treatment effect.
3. provide treatment recommendation tailored to patient's observed features

# 2 Background

## 2.1 Survival data
Three elements: patient's baseline data x, a failure event time T, event indicator E

Survival function: $S(t) = Pr(T>t)$: probability that patient has survived beyond time t.
Hazard function: measure of risk at time t

$$\lambda(t) = \lim_{\delta\to0} \frac{Pr(t\leq T<t+\delta|T\geq t)}{\delta}$$

A proportional hazards model is a common method for modeling patient's survival given baseline data x. Assumes the hazard function is composed of two functions: a baseline hazard function $\lambda_{0}(t)$ and a risk function $h(x)$
The hazard function is assumed to have the form $\lambda(t|x) = \lambda_{0}(t) \cdot e^{h(x)}$.

## 2.2 Linear Survival Models
CPH estimates the risk function h(x) by a linear function $\hat{h}_{\beta} = \beta^{T}x$

To perform Cox regression, tune weights $\beta$ to optimize the Cox partial likelihood.
The partial likelihood is the product of the probability at each event time $T_{i}$ that the event has occurred to patient $i$, given the set of individuals still at risk at time $T_{i}$. The Cox partial likelihood is parametrized by $\beta$ and defined as:

$$L_{c}(\beta) = \prod_{i:E_{i}=1} \frac{exp(\hat{h}_{\beta}(x_{i}))}{\sum_{j\in R(T_{i})} exp(\hat{h}_\beta (x_{j}))}$$

where T, E, and x are the event time, event indicator, and baseline data for a patient. The risk set $R(t)={i:T_{i}\geq t}$ os the set of patients still at risk of failure at time t.

## 2.3 Nonlinear survival models

The Faraggi-Simon method is a FFN that provides the basis for a nonlinear proportional hazards model.It replaces the linear combination of features $\hat{h}_{\beta} = \beta^{T}x$ with the output of the network $\hat{h}_{\theta}(x)$.
The Faraggi-Simon network has not been shown to outperform linear CPH. 

Random Survival Forest (RSF): tree method that produces an ensemble estimate for the cumulative hazard function.

More recent: DL approach, models the event time according to a Weibull distribution with parameters given by latent variables generated by a deep exponential family.

# 3 Methods

## 3.1 DeepSurv

DeepSurv is a multi-layer perceptron that predicts a patient's risk of death.
Output is an estimate of the risk function $\hat{h}_{\theta}(x)$_ parametrized by the weights of the MLP.

Loss function: negative log partial likelihood (similar to Faraggi-Simon)

$$l(\theta) := -\sum_{i:E_{i}=1} (\hat{h}_{\theta}(x_{i}) - log \sum_{j\in R(T_{i})} e^{\hat{h}_{\theta}(x_{j})})$$

## 3.2 Treatment recommender system

Patients' risk depends on their relevant features and treatment.
Let all patients in a given study be assigned to one of n treatment groups $\tau \in {0,1,...,n-1}$.
Assume each treatment $i$ to have an independent risk function $h_{i}(x)$. Collectively, the hazard function becomes:

\begin{equation}
\lambda(t;x|\tau=i) = \lambda_{0}(t) \cdot e^{h_{i}(x)}
\end{equation}

For any patient, the network should be able to accurately predict the risk $h_{i}(x)$ of being prescribed a given treatment $i$.
Then, based on assumption that each patient has the same baseline hazard function $\lambda_{0}(t)$, we can take the log of the hazards ratio to calculate the personal risk of prescribing one treatment option over another.

Recommender function: difference of log hazards

\begin{equation}
rec_{ij}(x) = log\big( \frac{\lambda(t;x|\tau=i)}{\lambda(t;x|\tau=j)})
= log\big( \frac{\lambda_{0}(t) \cdot e^{h_{i}(x)}}{\lambda_{0}(T)\cdot e^{h_{j}(x)}}) = h_{i}(x) - h_{j}(x)
\end{equation}




